<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <style>
    body {
      display: flex;
      flex-direction: column;
      max-width: 400px;
      border: 1px solid #131313;
      margin: 0 auto;
      margin-top: 10px;
      margin-bottom: 10px;
      font-size: 2em;
      text-align: center;
      box-shadow: 1px 1px 1px;
    }
    #result {
      padding: 1.4em;
    }

    #guess[correct] {
      color: green;
    }
    #guess[wrong] {
      color: rgb(211, 0, 0);
    }

    #guess {
      margin: 20px;
    }

    #guess button {
      width: 100px;
      font-size: 0.5em;
      background: #ff9b9b;
      margin-left: 20px;
      padding: 20px;
      border-radius: 8px;
    }
    #guess button:first-child {
      background: #91ff91;
    }
    .word,
    .definition {
      font-size: 0.8em;
    }
    .definition {
      font-style: italic;
    }
    .load-bar {
      background: red;
      height: 1px;
      width: 100%;
      animation-name: shrink;
      animation-duration: 4s;
      animation-timing-function: linear;
    }

    .generate {
      margin: auto;
    }

    @keyframes shrink {
      0% {
        width: 100%;
      }
      100% {
        width: 0%;
      }
    }
  </style>
  <body>
    <div id="result"></div>
    <div id="guess"></div>

    <button class="generate" onclick="generate()">Try Another</button>
  </body>
  <template id="chooser">
    <button onclick="it_is(true)">It Is</button>
    <button onclick="it_is(false)">It's Not</button>
  </template>
  <template id="guess-result-word">
    <p class="outcome"></p>
    <div class="word"></div>
    <div class="definition"></div>
  </template>
  <template id="loader">
    <div class="load-bar"></div>
  </template>

  <script>
    let retryTimeMs = 3000;
    let retryTimer = null;

    const alphabet = Array.from("abcdefghijklmnopqrstuvwxyz");

    const letters = (() => {
      // make vowels more common!
      let vowels = Array.from("aeiouy".repeat(10));
      return alphabet.concat(vowels);
    })();

    const target = document.querySelector("#result");
    const guess_result = document.querySelector("#guess");

    var acceptable = [];

    function random() {
      const ix = Math.floor(Math.random() * letters.length);
      return letters[ix];
    }

    function generate() {
      target.innerHTML = `${random().toUpperCase()}${random()}`;
      //target.innerHTML = "Ax";

      const buttons = document
        .querySelector("#chooser")
        .content.cloneNode(true);
      guess_result.innerHTML = "";
      guess_result.appendChild(buttons);

      clearInterval(retryTimer);
    }

    function it_is(guess) {
      const word = target.innerHTML.toUpperCase();
      const match = acceptable.filter((a) => a.WORD == word);
      const is_a_word = match.length > 0;
      console.log(match);

      const definition = is_a_word ? match[0].DEF : null;

      const message = `"${word}" is ${is_a_word ? "" : "NOT"} a word!`;
      const outcome = `You're ${is_a_word == guess ? "RIGHT!" : "WRONG!"}`;

      guess_result.innerHTML = "";
      if (is_a_word == guess) {
        guess_result.setAttribute("correct", is_a_word);
      } else {
        guess_result.setAttribute("wrong", is_a_word);
      }

      const result = document
        .querySelector("#guess-result-word")
        .content.cloneNode(true);
      result.querySelector(".outcome").innerText = outcome;

      if (is_a_word) {
        result.querySelector(".word").innerText = word;
      }

      result.querySelector(".definition").innerText = definition ?? message;

      guess_result.appendChild(result);

      guess_result.appendChild(buildLoader());

      retryTimer = setTimeout(generate, retryTimeMs);
    }

    function buildLoader() {
      var d = document.querySelector("#loader").content.cloneNode(true);
      d.querySelector(".load-bar").style.animationDuration = retryTimeMs + "ms";
      return d;
    }

    async function startup() {
      acceptable = await fetch("/words.json").then((t) => t.json());
      generate();
    }

    startup();
  </script>
</html>
